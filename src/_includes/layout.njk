<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>{{ title }}</title>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="{{ '/asset/style/app.css' | url }}" rel="stylesheet">
</head>
<body>

	<div class="app">
		<div class="app-grid">
			<div class="app-header">
				{% include "header.njk" %}
			</div>
			<main class="app-content">
				{{ content | safe }}
			</main>
		</div>
	</div>

	{% include "search.njk" %}

</body>
</html>
<script>

	let pagefindLoaded = false;
	let pagefindLoading = false;
	let searchUI = null;

	function loadStyle(href) {
		return new Promise((resolve) => {
			const link = document.createElement("link");
			link.rel = "stylesheet";
			link.href = href;
			link.onload = resolve;
			document.head.appendChild(link);
		});
	}

	function loadScript(src) {
		return new Promise((resolve) => {
			const script = document.createElement("script");
			script.src = src;
			script.defer = true;
			script.onload = resolve;
			document.body.appendChild(script);
		});
	}

	async function loadPagefind() {
		if (pagefindLoaded || pagefindLoading) {
			return;
		}
		pagefindLoading = true;

		await loadStyle("{{ '/pagefind/pagefind-ui.css' | url }}");
		await loadScript("{{ '/pagefind/pagefind-ui.js' | url }}");

		searchUI = new PagefindUI({
			element: "#search",
			autofocus: true,
			showSubResults: true,
			showImages: false
		});

		pagefindLoaded = true;
		pagefindLoading = false;
	}

	async function openSearch() {
		let searchOverlay = document.getElementById("search-overlay");
		searchOverlay.classList.remove("hidden");
		await loadPagefind();
	}

	function closeSearch() {
		let searchOverlay = document.getElementById("search-overlay");
		searchOverlay.classList.add("hidden");
	}

	document.getElementById("search-open").addEventListener("click", openSearch);
	document.getElementById("search-close").addEventListener("click", closeSearch);

	document.getElementById("search-overlay").addEventListener("click", (e) => {
		if (e.target.id === "search-overlay") {
			closeSearch();
		}
	});

</script>